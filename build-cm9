#!/bin/bash

CLOUD=/home/konrad/android/updates
BUILD_DIR=/home/konrad/android/builds/cm9
OUT=out/target/product/PHONE
CCACHE=$BUILD_DIR/prebuilt/linux-x86/ccache
PHONE=
Option1="Full Build"
Option2="Repo Sync"

export USE_CCACHE=1
export CCACHE_DIR=/home/konrad/android/.ccache

function sync {
    cd $BUILD_DIR
    repo sync -j16
}

function full {
    printf "Compile for which HTC Phone?\n"
    read PHONE

    cd $CCACHE
    ./ccache -M 40G
    cd $BUILD_DIR
    repo sync -j16
    make clean -j16
    . build/envsetup.sh
    lunch htc_$PHONE-eng
    make -j6 otapackage
    mv $OUT/htc_*.zip $CLOUD/$PHONE-cm9.zip
}

PS3='Please enter your choice: '
options=("$Option1" "$Option2" "Quit")
select opt in "${options[@]}"
do
    case $opt in
        "$Option1")
            full
            break
            ;;
        "$Option2")
            sync
            break
            ;;
        "Quit")
            break
            ;;
        *) echo invalid option;;
    esac
done
